# Image Classification with R
The objective of this project is to classify large amounts of images using R. The classification is to be made using 4 different models:

* Na√Øve Bayes
* Random Forest
* Deep Learning
* Support Vector Machines

### Requirements 
To succesfully use this project, you need a large compilation of images that are separated in at least 2 folders, each folder representing a class to be classified. The images need to be stored on a local directory. For this project we have two folders stored locally one with pictures of cars , obtained from [Kaggle](https://www.kaggle.com/senemanu/stanfordcarsfcs#01002.jpg), and another file of pictures that are not cars, obtained from the [Visual Genome](http://visualgenome.org/api/v0/api_home.html).

#### Libraries
The following libraries are required:
* `library(imager)`
* `library(tidyverse)`
* `library(h2o)`
* `library(kernlab)`

### The Process
The script `GetNumbersImages.R` uses the library `imager` and takes in two folders of images and returns a .csv file that has a column called `Label` and 75 other columns of features for each image in those directories. 
The script `ImageClassifer.R` takes in the csv file called `images.csv` generated by `GetNumbersImages.R` and usues the libraries `h2o` and `kernlab` to build classification models and return Accuracy, Recall, Precision, and Overfitting (AuC)

### How it works
The script `GetNumbersImages.R` uses the formula `getNumbers` wich transfors a image to a single row of numbers with a label using the following process:
1. Load the image, detect its edges, and rezising it to a standard 50x50px
2. Convert the image a data frame with 4 colomns x, y, cc, and value. X & Y represent a coordinate for each pixel of the image, cc consists of factors for R,G,and B, and value represents the R,B,or G value of that pixel.
3. Group the pixel groups by 10 per main color, resulting in 25 pixel groups per color which generates the 75 variables used in the models.
The script binds each generated row together and writes a csv file called `images.csv`

The script `ImageClassifer.R` uses `h2o` to generate the Naive Bayes, Deep Learning, and Random Forest models, and it uses `kernlab` to generate the Support Vector Machine model.

##### Usage
For a more detailed explanation of each step of the process, read the R Notebook file `images.Rmd` or the html version `images.nb.html`.
For a more straing forward process, use the scripts `GetNumbersImages.R` and `ImageClassifer.R`. You can make necesary changes to these files to adapt to your project.

### Results
Accuracy of the models was very low. 

| |Accurracy|Precition|Recall|AUC|
|:--|:-:|:-:|:-:|:-:|
|Naive Bayes|.50|1|1|.63|
|Random Forest|.52|1|1|.71|
|Deep Learning|.45|1|1|.70|
|Support Vector Machine|.52|1|1|.67|

### Working Rest API
A working API has been developed to classify images via the Naive Bayes Model

###### Interact With API
To Interact with the API, got the the base url `http://ec2-34-207-87-151.compute-1.amazonaws.com:8080/images?img=` and append a url for any image in the internet. The API will return it's classification.
The API is hosted on a AWS Linux EC2 intance. 

###### Example
For the example we are using this image: 
   
![BMW IMAGE](https://img.car.com/2019/bmw/m2/48966_11_2_320x.png)
   
Go To `http://ec2-34-207-87-151.compute-1.amazonaws.com:8080/images?img=https://img.car.com/2019/bmw/m2/48966_11_2_320x.png` or click [HERE](http://ec2-34-207-87-151.compute-1.amazonaws.com:8080/images?img=https://img.car.com/2019/bmw/m2/48966_11_2_320x.png)

#### Host Own API
The API is using library `plumber`. Edit files `LiveDemo.R` and `plumber.R` to create your own image classification API.

- `LiveDemo.R` Has the code for the model, this script requieres the `imagesFull.csv` file that contains all the numbers generated with `GetNumbersImages.R`

- `plumber.R` defines the parameters and methods for the API. Read more about `plumber` [here](https://www.rplumber.io/docs/index.html)

